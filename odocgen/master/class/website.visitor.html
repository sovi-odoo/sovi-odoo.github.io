<!doctype html><html lang="en"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>website.visitor - odocgen</title><link rel="stylesheet" href="class.css" /></head><body><h1>website.visitor</h1><p>Originally defined in: odoo/addons/website/models/website_visitor.py</p><p>Inherited in: odoo/addons/website_sms/models/website_visitor.py<br/>Inherited in: odoo/addons/website_sale/models/website_visitor.py<br/>Inherited in: odoo/addons/website_livechat/models/website_visitor.py<br/>Inherited in: odoo/addons/website_event_track/models/website_visitor.py<br/>Inherited in: odoo/addons/website_event/models/website_visitor.py<br/>Inherited in: odoo/addons/website_crm_sms/models/website_visitor.py<br/>Inherited in: odoo/addons/website_crm/models/website_visitor.py<br/></p><hr/><h2>Original: odoo/addons/website/models/website_visitor.py</h2><h3>Fields</h3><details><summary id="f-access_token">access_token <span class="position">@ line 55</span></summary><pre>access_token = fields.Char(required=True, default=_get_access_token, copy=False)</pre></details><details><summary id="f-country_flag">country_flag <span class="position">@ line 62</span></summary><pre>country_flag = fields.Char(related="country_id.image_url", string="Country Flag")</pre></details><details><summary id="f-country_id">country_id <span class="position">@ line 61</span></summary><pre>country_id = fields.Many2one('res.country', 'Country', readonly=True)</pre></details><details><summary id="f-create_date">create_date <span class="position">@ line 77</span></summary><pre>create_date = fields.Datetime('First Connection', readonly=True)</pre></details><details><summary id="f-email">email <span class="position">@ line 65</span></summary><pre>email = fields.Char(string='Email', compute='_compute_email_phone', compute_sudo=True)</pre></details><details><summary id="f-is_connected">is_connected <span class="position">@ line 80</span></summary><pre>is_connected = fields.Boolean('Is connected?', compute='_compute_time_statistics', help='A visitor is considered as connected if his last page view was within the last 5 minutes.')</pre></details><details><summary id="f-lang_id">lang_id <span class="position">@ line 63</span></summary><pre>lang_id = fields.Many2one('res.lang', string='Language', help="Language from the website when visitor has been created")</pre></details><details><summary id="f-last_connection_datetime">last_connection_datetime <span class="position">@ line 78</span></summary><pre>last_connection_datetime = fields.Datetime('Last Connection', default=fields.Datetime.now, help="Last page view date", readonly=True)</pre></details><details><summary id="f-last_visited_page_id">last_visited_page_id <span class="position">@ line 74</span></summary><pre>last_visited_page_id = fields.Many2one('website.page', string="Last Visited Page", compute="_compute_last_visited_page_id")</pre></details><details><summary id="f-mobile">mobile <span class="position">@ line 66</span></summary><pre>mobile = fields.Char(string='Mobile', compute='_compute_email_phone', compute_sudo=True)</pre></details><details><summary id="f-name">name <span class="position">@ line 54</span></summary><pre>name = fields.Char('Name', related='partner_id.name')</pre></details><details><summary id="f-page_count">page_count <span class="position">@ line 73</span></summary><pre>page_count = fields.Integer('# Visited Pages', compute="_compute_page_statistics", help="Total number of tracked page visited")</pre></details><details><summary id="f-page_ids">page_ids <span class="position">@ line 72</span></summary><pre>page_ids = fields.Many2many('website.page', string="Visited Pages", compute="_compute_page_statistics", groups="website.group_website_designer", search="_search_page_ids")</pre></details><details><summary id="f-partner_id">partner_id <span class="position">@ line 57</span></summary><pre>partner_id = fields.Many2one('res.partner', string="Contact", help="Partner of the last logged in user.", compute='_compute_partner_id', store=True, index='btree_not_null')</pre></details><details><summary id="f-partner_image">partner_image <span class="position">@ line 58</span></summary><pre>partner_image = fields.Binary(related='partner_id.image_1920')</pre></details><details><summary id="f-time_since_last_action">time_since_last_action <span class="position">@ line 79</span></summary><pre>time_since_last_action = fields.Char('Last action', compute="_compute_time_statistics", help='Time since last page view. E.g.: 2 minutes ago')</pre></details><details><summary id="f-timezone">timezone <span class="position">@ line 64</span></summary><pre>timezone = fields.Selection(_tz_get, string='Timezone')</pre></details><details><summary id="f-visit_count">visit_count <span class="position">@ line 69</span></summary><pre>visit_count = fields.Integer('# Visits', default=1, readonly=True, help="A new visit is considered if last connection was more than 8 hours ago.")</pre></details><details><summary id="f-visitor_page_count">visitor_page_count <span class="position">@ line 71</span></summary><pre>visitor_page_count = fields.Integer('Page Views', compute="_compute_page_statistics", help="Total number of visits on tracked pages")</pre></details><details><summary id="f-website_id">website_id <span class="position">@ line 56</span></summary><pre>website_id = fields.Many2one('website', "Website", readonly=True)</pre></details><details><summary id="f-website_track_ids">website_track_ids <span class="position">@ line 70</span></summary><pre>website_track_ids = fields.One2many('website.track', 'visitor_id', string='Visited Pages History', readonly=True)</pre></details><h3>Methods</h3><details><summary id="m-_add_tracking">_add_tracking(self, domain, website_track_values) <span class="position">@ line 303</span></summary><pre>Add the track and update the visitor</pre></details><details><summary id="m-_check_for_message_composer">_check_for_message_composer(self) <span class="position">@ line 160</span></summary><pre>Purpose of this method is to actualize visitor model prior to contacting
him. Used notably for inheritance purpose, when dealing with leads that
could update the visitor model.</pre></details><details><summary id="m-_cron_unlink_old_visitors">_cron_unlink_old_visitors(self, batch_size, limit) <span class="position">@ line 332</span></summary><pre>Unlink inactive visitors (see '_inactive_visitors_domain' for
details).

Visitors were previously archived but we came to the conclusion that
archived visitors have very little value and bloat the database for no
reason.</pre></details><details><summary id="m-_get_access_token">_get_access_token(self) <span class="position">@ line 37</span></summary><pre>Either the user's partner.id or a hash.</pre></details><details><summary id="m-_get_visitor_from_request">_get_visitor_from_request(self, force_create, force_track_values) <span class="position">@ line 258</span></summary><pre>Return the visitor as sudo from the request.

:param force_create: force a visitor creation if no visitor exists
:param force_track_values: an optional dict to create a track at the
same time.
:return: the website visitor if exists or forced, empty recordset
otherwise.</pre></details><ul id="m-_get_visitor_timezone"><li>_get_visitor_timezone(self) <span class="position">@ line 389</span></li></ul><details><summary id="m-_handle_webpage_dispatch">_handle_webpage_dispatch(self, website_page) <span class="position">@ line 289</span></summary><pre>Create a website.visitor if the http request object is a tracked
website.page or a tracked ir.ui.view.
Since this method is only called on tracked elements, the
last_connection_datetime might not be accurate as the visitor could have
been visiting only untracked page during his last visit.</pre></details><details><summary id="m-_inactive_visitors_domain">_inactive_visitors_domain(self) <span class="position">@ line 350</span></summary><pre>This method defines the domain of visitors that can be cleaned. By
default visitors not linked to any partner and not active for
'website.visitor.live.days' days (default being 60) are considered as
inactive.

This method is meant to be overridden by sub-modules to further refine
inactivity conditions.</pre></details><details><summary id="m-_merge_visitor">_merge_visitor(self, target) <span class="position">@ line 312</span></summary><pre>Merge an anonymous visitor data to a partner visitor then unlink
that anonymous visitor.
Purpose is to try to aggregate as much sub-records (tracked pages,
leads, ...) as possible.
It is especially useful to aggregate data from the same user on
different devices.

This method is meant to be overridden for other modules to merge their
own anonymous visitor data to the partner visitor before unlink.

This method is only called after the user logs in.

:param target: main visitor, target of link process;</pre></details><ul id="m-_prepare_message_composer_context"><li>_prepare_message_composer_context(self) <span class="position">@ line 166</span></li></ul><ul id="m-_search_page_ids"><li>_search_page_ids(self, operator, value) <span class="position">@ line 139</span></li></ul><ul id="m-_update_visitor_last_visit"><li>_update_visitor_last_visit(self) <span class="position">@ line 375</span></li></ul><details><summary id="m-_update_visitor_timezone">_update_visitor_timezone(self, timezone) <span class="position">@ line 363</span></summary><pre>We need to do this part here to avoid concurrent updates error.</pre></details><details><summary id="m-_upsert_visitor">_upsert_visitor(self, access_token, force_track_values) <span class="position">@ line 194</span></summary><pre>Based on the given `access_token`, either create or return the
related visitor if exists, through a single raw SQL UPSERT Query.

It will also create a tracking record if requested, in the same query.

:param access_token: token to be used to upsert the visitor
:param force_track_values: an optional dict to create a track at the
same time.
:return: a tuple containing the visitor id and the upsert result (either
`inserted` or `updated).</pre></details><ul id="m-action_send_mail"><li>action_send_mail(self) <span class="position">@ line 173</span></li></ul><h2>Inherited: odoo/addons/website_sms/models/website_visitor.py</h2><h3>Methods</h3><details><summary id="m-_check_for_sms_composer">_check_for_sms_composer(self) <span class="position">@ line 11</span></summary><pre>Purpose of this method is to actualize visitor model prior to contacting
him. Used notably for inheritance purpose, when dealing with leads that
could update the visitor model.</pre></details><ul id="m-_prepare_sms_composer_context"><li>_prepare_sms_composer_context(self) <span class="position">@ line 17</span></li></ul><ul id="m-action_send_sms"><li>action_send_sms(self) <span class="position">@ line 25</span></li></ul><h2>Inherited: odoo/addons/website_sale/models/website_visitor.py</h2><h3>Fields</h3><details><summary id="f-product_count">product_count <span class="position">@ line 19</span></summary><pre>product_count = fields.Integer(
        string='Products Views',
        help="Total number of product viewed",
        compute='_compute_product_statistics',
    )</pre></details><details><summary id="f-product_ids">product_ids <span class="position">@ line 14</span></summary><pre>product_ids = fields.Many2many(
        string="Visited Products",
        comodel_name='product.product',
        compute='_compute_product_statistics',
    )</pre></details><details><summary id="f-visitor_product_count">visitor_product_count <span class="position">@ line 9</span></summary><pre>visitor_product_count = fields.Integer(
        string="Product Views",
        help="Total number of views on products",
        compute='_compute_product_statistics',
    )</pre></details><h3>Methods</h3><details><summary id="m-_add_viewed_product">_add_viewed_product(self, product_id) <span class="position">@ line 43</span></summary><pre>add a website_track with a page marked as viewed</pre></details><h2>Inherited: odoo/addons/website_livechat/models/website_visitor.py</h2><h3>Fields</h3><details><summary id="f-discuss_channel_ids">discuss_channel_ids <span class="position">@ line 18</span></summary><pre>discuss_channel_ids = fields.One2many('discuss.channel', 'livechat_visitor_id',
                                       string="Visitor's livechat channels", readonly=True)</pre></details><details><summary id="f-livechat_operator_id">livechat_operator_id <span class="position">@ line 16</span></summary><pre>livechat_operator_id = fields.Many2one('res.partner', compute='_compute_livechat_operator_id', store=True, string='Speaking with', index='btree_not_null')</pre></details><details><summary id="f-livechat_operator_name">livechat_operator_name <span class="position">@ line 17</span></summary><pre>livechat_operator_name = fields.Char('Operator Name', related="livechat_operator_id.name")</pre></details><details><summary id="f-session_count">session_count <span class="position">@ line 20</span></summary><pre>session_count = fields.Integer('# Sessions', compute="_compute_session_count")</pre></details><h3>Methods</h3><ul id="m-_auto_init"><li>_auto_init(self) <span class="position">@ line 22</span></li></ul><details><summary id="m-_merge_visitor">_merge_visitor(self, target) <span class="position">@ line 111</span></summary><pre>Copy sessions of the secondary visitors to the main partner visitor.</pre></details><ul id="m-_upsert_visitor"><li>_upsert_visitor(self, access_token, force_track_values) <span class="position">@ line 120</span></li></ul><details><summary id="m-action_send_chat_request">action_send_chat_request(self) <span class="position">@ line 48</span></summary><pre>Send a chat request to website_visitor(s).
This creates a chat_request and a discuss_channel with livechat active flag.
But for the visitor to get the chat request, the operator still has to speak to the visitor.
The visitor will receive the chat request the next time he navigates to a website page.
(see _handle_webpage_dispatch for next step)</pre></details><h2>Inherited: odoo/addons/website_event_track/models/website_visitor.py</h2><h3>Fields</h3><details><summary id="f-event_track_visitor_ids">event_track_visitor_ids <span class="position">@ line 12</span></summary><pre>event_track_visitor_ids = fields.One2many(
        'event.track.visitor', 'visitor_id', string="Track Visitors",
        groups='event.group_event_user')</pre></details><details><summary id="f-event_track_wishlisted_count">event_track_wishlisted_count <span class="position">@ line 20</span></summary><pre>event_track_wishlisted_count = fields.Integer(
        string="# Wishlisted",
        compute="_compute_event_track_wishlisted_ids", compute_sudo=True,
        groups='event.group_event_user')</pre></details><details><summary id="f-event_track_wishlisted_ids">event_track_wishlisted_ids <span class="position">@ line 15</span></summary><pre>event_track_wishlisted_ids = fields.Many2many(
        'event.track', string="Wishlisted Tracks",
        compute="_compute_event_track_wishlisted_ids", compute_sudo=True,
        search="_search_event_track_wishlisted_ids",
        groups="event.group_event_user")</pre></details><h3>Methods</h3><details><summary id="m-_inactive_visitors_domain">_inactive_visitors_domain(self) <span class="position">@ line 50</span></summary><pre>Visitors registered to push subscriptions are considered always active and should not be
deleted.</pre></details><details><summary id="m-_merge_visitor">_merge_visitor(self, target) <span class="position">@ line 56</span></summary><pre>Override linking process to link wishlist to the final visitor.</pre></details><details><summary id="m-_search_event_track_wishlisted_ids">_search_event_track_wishlisted_ids(self, operator, operand) <span class="position">@ line 37</span></summary><pre>Search visitors with terms on wishlisted tracks. E.g. [('event_track_wishlisted_ids',
'in', [1, 2])] should return visitors having wishlisted tracks 1, 2.</pre></details><h2>Inherited: odoo/addons/website_event/models/website_visitor.py</h2><h3>Fields</h3><details><summary id="f-event_registered_ids">event_registered_ids <span class="position">@ line 18</span></summary><pre>event_registered_ids = fields.Many2many(
        'event.event', string="Registered Events",
        compute="_compute_event_registered_ids", compute_sudo=True,
        search="_search_event_registered_ids",
        groups="event.group_event_registration_desk")</pre></details><details><summary id="f-event_registration_count">event_registration_count <span class="position">@ line 15</span></summary><pre>event_registration_count = fields.Integer(
        '# Registrations', compute='_compute_event_registration_count',
        groups="event.group_event_registration_desk")</pre></details><details><summary id="f-event_registration_ids">event_registration_ids <span class="position">@ line 12</span></summary><pre>event_registration_ids = fields.One2many(
        'event.registration', 'visitor_id', string='Event Registrations',
        groups="event.group_event_registration_desk")</pre></details><h3>Methods</h3><details><summary id="m-_inactive_visitors_domain">_inactive_visitors_domain(self) <span class="position">@ line 78</span></summary><pre>Visitors registered to events are considered always active and should not be deleted.</pre></details><details><summary id="m-_merge_visitor">_merge_visitor(self, target) <span class="position">@ line 83</span></summary><pre>Override linking process to link registrations to the final visitor.</pre></details><details><summary id="m-_search_event_registered_ids">_search_event_registered_ids(self, operator, operand) <span class="position">@ line 61</span></summary><pre>Search visitors with terms on events within their event registrations. E.g. [('event_registered_ids',
'in', [1, 2])] should return visitors having a registration on events 1, 2 as
well as their children for notification purpose.</pre></details><h2>Inherited: odoo/addons/website_crm_sms/models/website_visitor.py</h2><h3>Methods</h3><ul id="m-_check_for_sms_composer"><li>_check_for_sms_composer(self) <span class="position">@ line 10</span></li></ul><ul id="m-_prepare_sms_composer_context"><li>_prepare_sms_composer_context(self) <span class="position">@ line 18</span></li></ul><h2>Inherited: odoo/addons/website_crm/models/website_visitor.py</h2><h3>Fields</h3><details><summary id="f-lead_count">lead_count <span class="position">@ line 12</span></summary><pre>lead_count = fields.Integer('# Leads', compute="_compute_lead_count", groups="sales_team.group_sale_salesman")</pre></details><details><summary id="f-lead_ids">lead_ids <span class="position">@ line 11</span></summary><pre>lead_ids = fields.Many2many('crm.lead', string='Leads', groups="sales_team.group_sale_salesman")</pre></details><h3>Methods</h3><ul id="m-_check_for_message_composer"><li>_check_for_message_composer(self) <span class="position">@ line 34</span></li></ul><details><summary id="m-_inactive_visitors_domain">_inactive_visitors_domain(self) <span class="position">@ line 46</span></summary><pre>Visitors tied to leads are considered always active and should not be deleted.</pre></details><details><summary id="m-_merge_visitor">_merge_visitor(self, target) <span class="position">@ line 51</span></summary><pre>Link the leads to the main visitor to avoid them being lost.</pre></details><ul id="m-_prepare_message_composer_context"><li>_prepare_message_composer_context(self) <span class="position">@ line 60</span></li></ul><script src="class.js"></script></body></html>
